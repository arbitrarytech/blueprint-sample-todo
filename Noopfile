COMPONENT vue static

ROUTE *

FROM node:16-alpine

WORKDIR vue
COPY /static/vue/package*.json ./
RUN npm ci
COPY /static/vue/index.html ./
COPY /static/vue/vite.config.js ./
COPY /static/vue/public ./public
COPY /static/vue/src ./src
RUN npm run build

ASSETS dist --single-page-mode --index-file index.html

COMPONENT express service

ROUTE /api/*

RESOURCE DynamoDBTable dynamodb -s hashKeyName=id -s hashKeyType=N
RESOURCE S3Bucket s3

FROM node:16-alpine

WORKDIR express
COPY /service/express/package*.json ./
RUN npm ci
COPY /service/express/index.js ./

EXPOSE 80
CMD ["npm", "start"]

ENV DYNAMODB_TABLE $.resources.DynamoDBTable.tableName
ENV DYNAMODB_ENDPOINT $.resources.DynamoDBTable.endpoint
ENV S3_BUCKET $.resources.S3Bucket.bucket
ENV S3_ENDPOINT $.resources.S3Bucket.endpoint
